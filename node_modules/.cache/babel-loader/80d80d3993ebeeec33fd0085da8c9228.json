{"ast":null,"code":"\"use strict\"; // Copyright 2018 Google LLC\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nvar _a;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.defaultErrorRedactor = exports.GaxiosError = exports.GAXIOS_ERROR_SYMBOL = void 0;\n\nconst url_1 = require(\"url\");\n\nconst util_1 = require(\"./util\");\n\nconst extend_1 = __importDefault(require(\"extend\"));\n/**\n * Support `instanceof` operator for `GaxiosError`s in different versions of this library.\n *\n * @see {@link GaxiosError[Symbol.hasInstance]}\n */\n\n\nexports.GAXIOS_ERROR_SYMBOL = Symbol.for(`${util_1.pkg.name}-gaxios-error`);\n/* eslint-disable-next-line @typescript-eslint/no-explicit-any */\n\nclass GaxiosError extends Error {\n  /**\n   * Support `instanceof` operator for `GaxiosError` across builds/duplicated files.\n   *\n   * @see {@link GAXIOS_ERROR_SYMBOL}\n   * @see {@link GaxiosError[GAXIOS_ERROR_SYMBOL]}\n   */\n  static [(_a = exports.GAXIOS_ERROR_SYMBOL, Symbol.hasInstance)](instance) {\n    if (instance && typeof instance === 'object' && exports.GAXIOS_ERROR_SYMBOL in instance && instance[exports.GAXIOS_ERROR_SYMBOL] === util_1.pkg.version) {\n      return true;\n    } // fallback to native\n\n\n    return Function.prototype[Symbol.hasInstance].call(GaxiosError, instance);\n  }\n\n  constructor(message, config, response, error) {\n    var _b;\n\n    super(message);\n    this.config = config;\n    this.response = response;\n    this.error = error;\n    /**\n     * Support `instanceof` operator for `GaxiosError` across builds/duplicated files.\n     *\n     * @see {@link GAXIOS_ERROR_SYMBOL}\n     * @see {@link GaxiosError[Symbol.hasInstance]}\n     * @see {@link https://github.com/microsoft/TypeScript/issues/13965#issuecomment-278570200}\n     * @see {@link https://stackoverflow.com/questions/46618852/require-and-instanceof}\n     * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/@@hasInstance#reverting_to_default_instanceof_behavior}\n     */\n\n    this[_a] = util_1.pkg.version; // deep-copy config as we do not want to mutate\n    // the existing config for future retries/use\n\n    this.config = (0, extend_1.default)(true, {}, config);\n\n    if (this.response) {\n      this.response.config = (0, extend_1.default)(true, {}, this.response.config);\n    }\n\n    if (this.response) {\n      try {\n        this.response.data = translateData(this.config.responseType, (_b = this.response) === null || _b === void 0 ? void 0 : _b.data);\n      } catch (_c) {// best effort - don't throw an error within an error\n        // we could set `this.response.config.responseType = 'unknown'`, but\n        // that would mutate future calls with this config object.\n      }\n\n      this.status = this.response.status;\n    }\n\n    if (error && 'code' in error && error.code) {\n      this.code = error.code;\n    }\n\n    if (config.errorRedactor) {\n      config.errorRedactor({\n        config: this.config,\n        response: this.response\n      });\n    }\n  }\n\n}\n\nexports.GaxiosError = GaxiosError;\n\nfunction translateData(responseType, data) {\n  switch (responseType) {\n    case 'stream':\n      return data;\n\n    case 'json':\n      return JSON.parse(JSON.stringify(data));\n\n    case 'arraybuffer':\n      return JSON.parse(Buffer.from(data).toString('utf8'));\n\n    case 'blob':\n      return JSON.parse(data.text());\n\n    default:\n      return data;\n  }\n}\n/**\n * An experimental error redactor.\n *\n * @param config Config to potentially redact properties of\n * @param response Config to potentially redact properties of\n *\n * @experimental\n */\n\n\nfunction defaultErrorRedactor(data) {\n  const REDACT = '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.';\n\n  function redactHeaders(headers) {\n    if (!headers) return;\n\n    for (const key of Object.keys(headers)) {\n      // any casing of `Authentication`\n      if (/^authentication$/i.test(key)) {\n        headers[key] = REDACT;\n      } // any casing of `Authorization`\n\n\n      if (/^authorization$/i.test(key)) {\n        headers[key] = REDACT;\n      } // anything containing secret, such as 'client secret'\n\n\n      if (/secret/i.test(key)) {\n        headers[key] = REDACT;\n      }\n    }\n  }\n\n  function redactString(obj, key) {\n    if (typeof obj === 'object' && obj !== null && typeof obj[key] === 'string') {\n      const text = obj[key];\n\n      if (/grant_type=/i.test(text) || /assertion=/i.test(text) || /secret/i.test(text)) {\n        obj[key] = REDACT;\n      }\n    }\n  }\n\n  function redactObject(obj) {\n    if (typeof obj === 'object' && obj !== null) {\n      if ('grant_type' in obj) {\n        obj['grant_type'] = REDACT;\n      }\n\n      if ('assertion' in obj) {\n        obj['assertion'] = REDACT;\n      }\n\n      if ('client_secret' in obj) {\n        obj['client_secret'] = REDACT;\n      }\n    }\n  }\n\n  if (data.config) {\n    redactHeaders(data.config.headers);\n    redactString(data.config, 'data');\n    redactObject(data.config.data);\n    redactString(data.config, 'body');\n    redactObject(data.config.body);\n\n    try {\n      const url = new url_1.URL('', data.config.url);\n\n      if (url.searchParams.has('token')) {\n        url.searchParams.set('token', REDACT);\n      }\n\n      if (url.searchParams.has('client_secret')) {\n        url.searchParams.set('client_secret', REDACT);\n      }\n\n      data.config.url = url.toString();\n    } catch (_b) {// ignore error - no need to parse an invalid URL\n    }\n  }\n\n  if (data.response) {\n    defaultErrorRedactor({\n      config: data.response.config\n    });\n    redactHeaders(data.response.headers);\n    redactString(data.response, 'data');\n    redactObject(data.response.data);\n  }\n\n  return data;\n}\n\nexports.defaultErrorRedactor = defaultErrorRedactor;","map":{"version":3,"mappings":"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","names":["exports","Symbol","for","util_1","name","GaxiosError","Error","_a","hasInstance","instance","version","Function","prototype","call","constructor","message","config","response","error","data","translateData","responseType","_b","status","code","errorRedactor","JSON","parse","stringify","Buffer","from","toString","text","defaultErrorRedactor","REDACT","redactHeaders","headers","key","Object","keys","test","redactString","obj","redactObject","body","url","url_1","searchParams","has","set"],"sourceRoot":"","sources":["../../src/common.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}