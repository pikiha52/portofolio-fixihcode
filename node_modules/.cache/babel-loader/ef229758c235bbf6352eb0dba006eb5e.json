{"ast":null,"code":"/*!\n * lightgallery | 2.6.0 | August 29th 2022\n * http://www.lightgalleryjs.com/\n * Copyright (c) 2020 Sachin Neravath;\n * @license GPLv3\n */\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar zoomSettings = {\n  scale: 1,\n  zoom: true,\n  actualSize: true,\n  showZoomInOutIcons: false,\n  actualSizeIcons: {\n    zoomIn: 'lg-zoom-in',\n    zoomOut: 'lg-zoom-out'\n  },\n  enableZoomAfter: 300,\n  zoomPluginStrings: {\n    zoomIn: 'Zoom in',\n    zoomOut: 'Zoom out',\n    viewActualSize: 'View actual size'\n  }\n};\n/**\r\n * List of lightGallery events\r\n * All events should be documented here\r\n * Below interfaces are used to build the website documentations\r\n * */\n\nvar lGEvents = {\n  afterAppendSlide: 'lgAfterAppendSlide',\n  init: 'lgInit',\n  hasVideo: 'lgHasVideo',\n  containerResize: 'lgContainerResize',\n  updateSlides: 'lgUpdateSlides',\n  afterAppendSubHtml: 'lgAfterAppendSubHtml',\n  beforeOpen: 'lgBeforeOpen',\n  afterOpen: 'lgAfterOpen',\n  slideItemLoad: 'lgSlideItemLoad',\n  beforeSlide: 'lgBeforeSlide',\n  afterSlide: 'lgAfterSlide',\n  posterClick: 'lgPosterClick',\n  dragStart: 'lgDragStart',\n  dragMove: 'lgDragMove',\n  dragEnd: 'lgDragEnd',\n  beforeNextSlide: 'lgBeforeNextSlide',\n  beforePrevSlide: 'lgBeforePrevSlide',\n  beforeClose: 'lgBeforeClose',\n  afterClose: 'lgAfterClose',\n  rotateLeft: 'lgRotateLeft',\n  rotateRight: 'lgRotateRight',\n  flipHorizontal: 'lgFlipHorizontal',\n  flipVertical: 'lgFlipVertical',\n  autoplay: 'lgAutoplay',\n  autoplayStart: 'lgAutoplayStart',\n  autoplayStop: 'lgAutoplayStop'\n};\n\nvar Zoom =\n/** @class */\nfunction () {\n  function Zoom(instance, $LG) {\n    // get lightGallery core plugin instance\n    this.core = instance;\n    this.$LG = $LG;\n    this.settings = __assign(__assign({}, zoomSettings), this.core.settings);\n    return this;\n  } // Append Zoom controls. Actual size, Zoom-in, Zoom-out\n\n\n  Zoom.prototype.buildTemplates = function () {\n    var zoomIcons = this.settings.showZoomInOutIcons ? \"<button id=\\\"\" + this.core.getIdName('lg-zoom-in') + \"\\\" type=\\\"button\\\" aria-label=\\\"\" + this.settings.zoomPluginStrings['zoomIn'] + \"\\\" class=\\\"lg-zoom-in lg-icon\\\"></button><button id=\\\"\" + this.core.getIdName('lg-zoom-out') + \"\\\" type=\\\"button\\\" aria-label=\\\"\" + this.settings.zoomPluginStrings['zoomIn'] + \"\\\" class=\\\"lg-zoom-out lg-icon\\\"></button>\" : '';\n\n    if (this.settings.actualSize) {\n      zoomIcons += \"<button id=\\\"\" + this.core.getIdName('lg-actual-size') + \"\\\" type=\\\"button\\\" aria-label=\\\"\" + this.settings.zoomPluginStrings['viewActualSize'] + \"\\\" class=\\\"\" + this.settings.actualSizeIcons.zoomIn + \" lg-icon\\\"></button>\";\n    }\n\n    this.core.outer.addClass('lg-use-transition-for-zoom');\n    this.core.$toolbar.first().append(zoomIcons);\n  };\n  /**\r\n   * @desc Enable zoom option only once the image is completely loaded\r\n   * If zoomFromOrigin is true, Zoom is enabled once the dummy image has been inserted\r\n   *\r\n   * Zoom styles are defined under lg-zoomable CSS class.\r\n   */\n\n\n  Zoom.prototype.enableZoom = function (event) {\n    var _this = this; // delay will be 0 except first time\n\n\n    var _speed = this.settings.enableZoomAfter + event.detail.delay; // set _speed value 0 if gallery opened from direct url and if it is first slide\n\n\n    if (this.$LG('body').first().hasClass('lg-from-hash') && event.detail.delay) {\n      // will execute only once\n      _speed = 0;\n    } else {\n      // Remove lg-from-hash to enable starting animation.\n      this.$LG('body').first().removeClass('lg-from-hash');\n    }\n\n    this.zoomableTimeout = setTimeout(function () {\n      if (!_this.isImageSlide()) {\n        return;\n      }\n\n      _this.core.getSlideItem(event.detail.index).addClass('lg-zoomable');\n\n      if (event.detail.index === _this.core.index) {\n        _this.setZoomEssentials();\n      }\n    }, _speed + 30);\n  };\n\n  Zoom.prototype.enableZoomOnSlideItemLoad = function () {\n    // Add zoomable class\n    this.core.LGel.on(lGEvents.slideItemLoad + \".zoom\", this.enableZoom.bind(this));\n  };\n\n  Zoom.prototype.getDragCords = function (e) {\n    return {\n      x: e.pageX,\n      y: e.pageY\n    };\n  };\n\n  Zoom.prototype.getSwipeCords = function (e) {\n    var x = e.touches[0].pageX;\n    var y = e.touches[0].pageY;\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  Zoom.prototype.getDragAllowedAxises = function (scale, scaleDiff) {\n    var $image = this.core.getSlideItem(this.core.index).find('.lg-image').first().get();\n    var height = 0;\n    var width = 0;\n    var rect = $image.getBoundingClientRect();\n\n    if (scale) {\n      height = $image.offsetHeight * scale;\n      width = $image.offsetWidth * scale;\n    } else if (scaleDiff) {\n      height = rect.height + scaleDiff * rect.height;\n      width = rect.width + scaleDiff * rect.width;\n    } else {\n      height = rect.height;\n      width = rect.width;\n    }\n\n    var allowY = height > this.containerRect.height;\n    var allowX = width > this.containerRect.width;\n    return {\n      allowX: allowX,\n      allowY: allowY\n    };\n  };\n\n  Zoom.prototype.setZoomEssentials = function () {\n    this.containerRect = this.core.$content.get().getBoundingClientRect();\n  };\n  /**\r\n   * @desc Image zoom\r\n   * Translate the wrap and scale the image to get better user experience\r\n   *\r\n   * @param {String} scale - Zoom decrement/increment value\r\n   */\n\n\n  Zoom.prototype.zoomImage = function (scale, scaleDiff, reposition, resetToMax) {\n    if (Math.abs(scaleDiff) <= 0) return;\n    var offsetX = this.containerRect.width / 2 + this.containerRect.left;\n    var offsetY = this.containerRect.height / 2 + this.containerRect.top + this.scrollTop;\n    var originalX;\n    var originalY;\n\n    if (scale === 1) {\n      this.positionChanged = false;\n    }\n\n    var dragAllowedAxises = this.getDragAllowedAxises(0, scaleDiff);\n    var allowY = dragAllowedAxises.allowY,\n        allowX = dragAllowedAxises.allowX;\n\n    if (this.positionChanged) {\n      originalX = this.left / (this.scale - scaleDiff);\n      originalY = this.top / (this.scale - scaleDiff);\n      this.pageX = offsetX - originalX;\n      this.pageY = offsetY - originalY;\n      this.positionChanged = false;\n    }\n\n    var possibleSwipeCords = this.getPossibleSwipeDragCords(scaleDiff);\n    var x;\n    var y;\n\n    var _x = offsetX - this.pageX;\n\n    var _y = offsetY - this.pageY;\n\n    if (scale - scaleDiff > 1) {\n      var scaleVal = (scale - scaleDiff) / Math.abs(scaleDiff);\n      _x = (scaleDiff < 0 ? -_x : _x) + this.left * (scaleVal + (scaleDiff < 0 ? -1 : 1));\n      _y = (scaleDiff < 0 ? -_y : _y) + this.top * (scaleVal + (scaleDiff < 0 ? -1 : 1));\n      x = _x / scaleVal;\n      y = _y / scaleVal;\n    } else {\n      var scaleVal = (scale - scaleDiff) * scaleDiff;\n      x = _x * scaleVal;\n      y = _y * scaleVal;\n    }\n\n    if (reposition) {\n      if (allowX) {\n        if (this.isBeyondPossibleLeft(x, possibleSwipeCords.minX)) {\n          x = possibleSwipeCords.minX;\n        } else if (this.isBeyondPossibleRight(x, possibleSwipeCords.maxX)) {\n          x = possibleSwipeCords.maxX;\n        }\n      } else {\n        if (scale > 1) {\n          if (x < possibleSwipeCords.minX) {\n            x = possibleSwipeCords.minX;\n          } else if (x > possibleSwipeCords.maxX) {\n            x = possibleSwipeCords.maxX;\n          }\n        }\n      } // @todo fix this\n\n\n      if (allowY) {\n        if (this.isBeyondPossibleTop(y, possibleSwipeCords.minY)) {\n          y = possibleSwipeCords.minY;\n        } else if (this.isBeyondPossibleBottom(y, possibleSwipeCords.maxY)) {\n          y = possibleSwipeCords.maxY;\n        }\n      } else {\n        // If the translate value based on index of beyond the viewport, utilize the available space to prevent image being cut out\n        if (scale > 1) {\n          //If image goes beyond viewport top, use the minim possible translate value\n          if (y < possibleSwipeCords.minY) {\n            y = possibleSwipeCords.minY;\n          } else if (y > possibleSwipeCords.maxY) {\n            y = possibleSwipeCords.maxY;\n          }\n        }\n      }\n    }\n\n    this.setZoomStyles({\n      x: x,\n      y: y,\n      scale: scale\n    });\n    this.left = x;\n    this.top = y;\n\n    if (resetToMax) {\n      var actualSizeScale = this.getCurrentImageActualSizeScale();\n\n      if (scale >= actualSizeScale) {\n        this.setZoomImageSize();\n      }\n    }\n  };\n\n  Zoom.prototype.resetImageTranslate = function () {\n    var $image = this.core.getSlideItem(this.core.index).find('.lg-image').first();\n    this.imageReset = false;\n    $image.removeClass('reset-transition reset-transition-y reset-transition-x');\n    this.core.outer.removeClass('lg-actual-size');\n    $image.css('width', 'auto').css('height', 'auto');\n    setTimeout(function () {\n      $image.removeClass('no-transition');\n    }, 10);\n  };\n\n  Zoom.prototype.setZoomImageSize = function () {\n    var _this = this;\n\n    var $image = this.core.getSlideItem(this.core.index).find('.lg-image').first();\n    setTimeout(function () {\n      $image.addClass('no-transition');\n      _this.imageReset = true;\n    }, 500);\n    setTimeout(function () {\n      var dragAllowedAxises = _this.getDragAllowedAxises(_this.scale);\n\n      $image.css('width', $image.get().naturalWidth + 'px').css('height', $image.get().naturalHeight + 'px');\n\n      _this.core.outer.addClass('lg-actual-size');\n\n      if (dragAllowedAxises.allowX && dragAllowedAxises.allowY) {\n        $image.addClass('reset-transition');\n      } else if (dragAllowedAxises.allowX && !dragAllowedAxises.allowY) {\n        $image.addClass('reset-transition-x');\n      } else if (!dragAllowedAxises.allowX && dragAllowedAxises.allowY) {\n        $image.addClass('reset-transition-y');\n      }\n    }, 550);\n  };\n  /**\r\n   * @desc apply scale3d to image and translate to image wrap\r\n   * @param {style} X,Y and scale\r\n   */\n\n\n  Zoom.prototype.setZoomStyles = function (style) {\n    var $imageWrap = this.core.getSlideItem(this.core.index).find('.lg-img-wrap').first();\n    var $image = this.core.getSlideItem(this.core.index).find('.lg-image').first();\n    var $dummyImage = this.core.outer.find('.lg-current .lg-dummy-img').first();\n    this.scale = style.scale;\n    $image.css('transform', 'scale3d(' + style.scale + ', ' + style.scale + ', 1)');\n    $dummyImage.css('transform', 'scale3d(' + style.scale + ', ' + style.scale + ', 1)');\n    var transform = 'translate3d(' + style.x + 'px, ' + style.y + 'px, 0)';\n    $imageWrap.css('transform', transform);\n  };\n  /**\r\n   * @param index - Index of the current slide\r\n   * @param event - event will be available only if the function is called on clicking/taping the imags\r\n   */\n\n\n  Zoom.prototype.setActualSize = function (index, event) {\n    var _this = this;\n\n    var currentItem = this.core.galleryItems[this.core.index];\n    this.resetImageTranslate();\n    setTimeout(function () {\n      // Allow zoom only on image\n      if (!currentItem.src || _this.core.outer.hasClass('lg-first-slide-loading')) {\n        return;\n      }\n\n      var scale = _this.getCurrentImageActualSizeScale();\n\n      var prevScale = _this.scale;\n\n      if (_this.core.outer.hasClass('lg-zoomed')) {\n        _this.scale = 1;\n      } else {\n        _this.scale = _this.getScale(scale);\n      }\n\n      _this.setPageCords(event);\n\n      _this.beginZoom(_this.scale);\n\n      _this.zoomImage(_this.scale, _this.scale - prevScale, true, true);\n\n      setTimeout(function () {\n        _this.core.outer.removeClass('lg-grabbing').addClass('lg-grab');\n      }, 10);\n    }, 50);\n  };\n\n  Zoom.prototype.getNaturalWidth = function (index) {\n    var $image = this.core.getSlideItem(index).find('.lg-image').first();\n    var naturalWidth = this.core.galleryItems[index].width;\n    return naturalWidth ? parseFloat(naturalWidth) : $image.get().naturalWidth;\n  };\n\n  Zoom.prototype.getActualSizeScale = function (naturalWidth, width) {\n    var _scale;\n\n    var scale;\n\n    if (naturalWidth >= width) {\n      _scale = naturalWidth / width;\n      scale = _scale || 2;\n    } else {\n      scale = 1;\n    }\n\n    return scale;\n  };\n\n  Zoom.prototype.getCurrentImageActualSizeScale = function () {\n    var $image = this.core.getSlideItem(this.core.index).find('.lg-image').first();\n    var width = $image.get().offsetWidth;\n    var naturalWidth = this.getNaturalWidth(this.core.index) || width;\n    return this.getActualSizeScale(naturalWidth, width);\n  };\n\n  Zoom.prototype.getPageCords = function (event) {\n    var cords = {};\n\n    if (event) {\n      cords.x = event.pageX || event.touches[0].pageX;\n      cords.y = event.pageY || event.touches[0].pageY;\n    } else {\n      var containerRect = this.core.$content.get().getBoundingClientRect();\n      cords.x = containerRect.width / 2 + containerRect.left;\n      cords.y = containerRect.height / 2 + this.scrollTop + containerRect.top;\n    }\n\n    return cords;\n  };\n\n  Zoom.prototype.setPageCords = function (event) {\n    var pageCords = this.getPageCords(event);\n    this.pageX = pageCords.x;\n    this.pageY = pageCords.y;\n  };\n\n  Zoom.prototype.manageActualPixelClassNames = function () {\n    var $actualSize = this.core.getElementById('lg-actual-size');\n    $actualSize.removeClass(this.settings.actualSizeIcons.zoomIn).addClass(this.settings.actualSizeIcons.zoomOut);\n  }; // If true, zoomed - in else zoomed out\n\n\n  Zoom.prototype.beginZoom = function (scale) {\n    this.core.outer.removeClass('lg-zoom-drag-transition lg-zoom-dragging');\n\n    if (scale > 1) {\n      this.core.outer.addClass('lg-zoomed');\n      this.manageActualPixelClassNames();\n    } else {\n      this.resetZoom();\n    }\n\n    return scale > 1;\n  };\n\n  Zoom.prototype.getScale = function (scale) {\n    var actualSizeScale = this.getCurrentImageActualSizeScale();\n\n    if (scale < 1) {\n      scale = 1;\n    } else if (scale > actualSizeScale) {\n      scale = actualSizeScale;\n    }\n\n    return scale;\n  };\n\n  Zoom.prototype.init = function () {\n    var _this = this;\n\n    if (!this.settings.zoom) {\n      return;\n    }\n\n    this.buildTemplates();\n    this.enableZoomOnSlideItemLoad();\n    var tapped = null;\n    this.core.outer.on('dblclick.lg', function (event) {\n      if (!_this.$LG(event.target).hasClass('lg-image')) {\n        return;\n      }\n\n      _this.setActualSize(_this.core.index, event);\n    });\n    this.core.outer.on('touchstart.lg', function (event) {\n      var $target = _this.$LG(event.target);\n\n      if (event.touches.length === 1 && $target.hasClass('lg-image')) {\n        if (!tapped) {\n          tapped = setTimeout(function () {\n            tapped = null;\n          }, 300);\n        } else {\n          clearTimeout(tapped);\n          tapped = null;\n          event.preventDefault();\n\n          _this.setActualSize(_this.core.index, event);\n        }\n      }\n    });\n    this.core.LGel.on(lGEvents.containerResize + \".zoom \" + lGEvents.rotateRight + \".zoom \" + lGEvents.rotateLeft + \".zoom \" + lGEvents.flipHorizontal + \".zoom \" + lGEvents.flipVertical + \".zoom\", function () {\n      if (!_this.core.lgOpened || !_this.isImageSlide() || _this.core.touchAction) {\n        return;\n      }\n\n      var _LGel = _this.core.getSlideItem(_this.core.index).find('.lg-img-wrap').first();\n\n      _this.top = 0;\n      _this.left = 0;\n\n      _this.setZoomEssentials();\n\n      _this.setZoomSwipeStyles(_LGel, {\n        x: 0,\n        y: 0\n      });\n\n      _this.positionChanged = true;\n    }); // Update zoom on resize and orientationchange\n\n    this.$LG(window).on(\"scroll.lg.zoom.global\" + this.core.lgId, function () {\n      if (!_this.core.lgOpened) return;\n      _this.scrollTop = _this.$LG(window).scrollTop();\n    });\n    this.core.getElementById('lg-zoom-out').on('click.lg', function () {\n      // Allow zoom only on image\n      if (!_this.isImageSlide()) {\n        return;\n      }\n\n      var timeout = 0;\n\n      if (_this.imageReset) {\n        _this.resetImageTranslate();\n\n        timeout = 50;\n      }\n\n      setTimeout(function () {\n        var scale = _this.scale - _this.settings.scale;\n\n        if (scale < 1) {\n          scale = 1;\n        }\n\n        _this.beginZoom(scale);\n\n        _this.zoomImage(scale, -_this.settings.scale, true, true);\n      }, timeout);\n    });\n    this.core.getElementById('lg-zoom-in').on('click.lg', function () {\n      _this.zoomIn();\n    });\n    this.core.getElementById('lg-actual-size').on('click.lg', function () {\n      _this.setActualSize(_this.core.index);\n    });\n    this.core.LGel.on(lGEvents.beforeOpen + \".zoom\", function () {\n      _this.core.outer.find('.lg-item').removeClass('lg-zoomable');\n    });\n    this.core.LGel.on(lGEvents.afterOpen + \".zoom\", function () {\n      _this.scrollTop = _this.$LG(window).scrollTop(); // Set the initial value center\n\n      _this.pageX = _this.core.outer.width() / 2;\n      _this.pageY = _this.core.outer.height() / 2 + _this.scrollTop;\n      _this.scale = 1;\n    }); // Reset zoom on slide change\n\n    this.core.LGel.on(lGEvents.afterSlide + \".zoom\", function (event) {\n      var prevIndex = event.detail.prevIndex;\n      _this.scale = 1;\n      _this.positionChanged = false;\n\n      _this.resetZoom(prevIndex);\n\n      if (_this.isImageSlide()) {\n        _this.setZoomEssentials();\n      }\n    }); // Drag option after zoom\n\n    this.zoomDrag();\n    this.pinchZoom();\n    this.zoomSwipe(); // Store the zoomable timeout value just to clear it while closing\n\n    this.zoomableTimeout = false;\n    this.positionChanged = false;\n  };\n\n  Zoom.prototype.zoomIn = function () {\n    // Allow zoom only on image\n    if (!this.isImageSlide()) {\n      return;\n    }\n\n    var scale = this.scale + this.settings.scale;\n    scale = this.getScale(scale);\n    this.beginZoom(scale);\n    this.zoomImage(scale, this.settings.scale, true, true);\n  }; // Reset zoom effect\n\n\n  Zoom.prototype.resetZoom = function (index) {\n    this.core.outer.removeClass('lg-zoomed lg-zoom-drag-transition');\n    var $actualSize = this.core.getElementById('lg-actual-size');\n    var $item = this.core.getSlideItem(index !== undefined ? index : this.core.index);\n    $actualSize.removeClass(this.settings.actualSizeIcons.zoomOut).addClass(this.settings.actualSizeIcons.zoomIn);\n    $item.find('.lg-img-wrap').first().removeAttr('style');\n    $item.find('.lg-image').first().removeAttr('style');\n    this.scale = 1;\n    this.left = 0;\n    this.top = 0; // Reset pagx pagy values to center\n\n    this.setPageCords();\n  };\n\n  Zoom.prototype.getTouchDistance = function (e) {\n    return Math.sqrt((e.touches[0].pageX - e.touches[1].pageX) * (e.touches[0].pageX - e.touches[1].pageX) + (e.touches[0].pageY - e.touches[1].pageY) * (e.touches[0].pageY - e.touches[1].pageY));\n  };\n\n  Zoom.prototype.pinchZoom = function () {\n    var _this = this;\n\n    var startDist = 0;\n    var pinchStarted = false;\n    var initScale = 1;\n    var prevScale = 0;\n    var $item = this.core.getSlideItem(this.core.index);\n    this.core.outer.on('touchstart.lg', function (e) {\n      $item = _this.core.getSlideItem(_this.core.index);\n\n      if (!_this.isImageSlide()) {\n        return;\n      }\n\n      if (e.touches.length === 2) {\n        e.preventDefault();\n\n        if (_this.core.outer.hasClass('lg-first-slide-loading')) {\n          return;\n        }\n\n        initScale = _this.scale || 1;\n\n        _this.core.outer.removeClass('lg-zoom-drag-transition lg-zoom-dragging');\n\n        _this.setPageCords(e);\n\n        _this.resetImageTranslate();\n\n        _this.core.touchAction = 'pinch';\n        startDist = _this.getTouchDistance(e);\n      }\n    });\n    this.core.$inner.on('touchmove.lg', function (e) {\n      if (e.touches.length === 2 && _this.core.touchAction === 'pinch' && (_this.$LG(e.target).hasClass('lg-item') || $item.get().contains(e.target))) {\n        e.preventDefault();\n\n        var endDist = _this.getTouchDistance(e);\n\n        var distance = startDist - endDist;\n\n        if (!pinchStarted && Math.abs(distance) > 5) {\n          pinchStarted = true;\n        }\n\n        if (pinchStarted) {\n          prevScale = _this.scale;\n\n          var _scale = Math.max(1, initScale + -distance * 0.02);\n\n          _this.scale = Math.round((_scale + Number.EPSILON) * 100) / 100;\n          var diff = _this.scale - prevScale;\n\n          _this.zoomImage(_this.scale, Math.round((diff + Number.EPSILON) * 100) / 100, false, false);\n        }\n      }\n    });\n    this.core.$inner.on('touchend.lg', function (e) {\n      if (_this.core.touchAction === 'pinch' && (_this.$LG(e.target).hasClass('lg-item') || $item.get().contains(e.target))) {\n        pinchStarted = false;\n        startDist = 0;\n\n        if (_this.scale <= 1) {\n          _this.resetZoom();\n        } else {\n          var actualSizeScale = _this.getCurrentImageActualSizeScale();\n\n          if (_this.scale >= actualSizeScale) {\n            var scaleDiff = actualSizeScale - _this.scale;\n\n            if (scaleDiff === 0) {\n              scaleDiff = 0.01;\n            }\n\n            _this.zoomImage(actualSizeScale, scaleDiff, false, true);\n          }\n\n          _this.manageActualPixelClassNames();\n\n          _this.core.outer.addClass('lg-zoomed');\n        }\n\n        _this.core.touchAction = undefined;\n      }\n    });\n  };\n\n  Zoom.prototype.touchendZoom = function (startCoords, endCoords, allowX, allowY, touchDuration) {\n    var distanceXnew = endCoords.x - startCoords.x;\n    var distanceYnew = endCoords.y - startCoords.y;\n    var speedX = Math.abs(distanceXnew) / touchDuration + 1;\n    var speedY = Math.abs(distanceYnew) / touchDuration + 1;\n\n    if (speedX > 2) {\n      speedX += 1;\n    }\n\n    if (speedY > 2) {\n      speedY += 1;\n    }\n\n    distanceXnew = distanceXnew * speedX;\n    distanceYnew = distanceYnew * speedY;\n\n    var _LGel = this.core.getSlideItem(this.core.index).find('.lg-img-wrap').first();\n\n    var distance = {};\n    distance.x = this.left + distanceXnew;\n    distance.y = this.top + distanceYnew;\n    var possibleSwipeCords = this.getPossibleSwipeDragCords();\n\n    if (Math.abs(distanceXnew) > 15 || Math.abs(distanceYnew) > 15) {\n      if (allowY) {\n        if (this.isBeyondPossibleTop(distance.y, possibleSwipeCords.minY)) {\n          distance.y = possibleSwipeCords.minY;\n        } else if (this.isBeyondPossibleBottom(distance.y, possibleSwipeCords.maxY)) {\n          distance.y = possibleSwipeCords.maxY;\n        }\n      }\n\n      if (allowX) {\n        if (this.isBeyondPossibleLeft(distance.x, possibleSwipeCords.minX)) {\n          distance.x = possibleSwipeCords.minX;\n        } else if (this.isBeyondPossibleRight(distance.x, possibleSwipeCords.maxX)) {\n          distance.x = possibleSwipeCords.maxX;\n        }\n      }\n\n      if (allowY) {\n        this.top = distance.y;\n      } else {\n        distance.y = this.top;\n      }\n\n      if (allowX) {\n        this.left = distance.x;\n      } else {\n        distance.x = this.left;\n      }\n\n      this.setZoomSwipeStyles(_LGel, distance);\n      this.positionChanged = true;\n    }\n  };\n\n  Zoom.prototype.getZoomSwipeCords = function (startCoords, endCoords, allowX, allowY, possibleSwipeCords) {\n    var distance = {};\n\n    if (allowY) {\n      distance.y = this.top + (endCoords.y - startCoords.y);\n\n      if (this.isBeyondPossibleTop(distance.y, possibleSwipeCords.minY)) {\n        var diffMinY = possibleSwipeCords.minY - distance.y;\n        distance.y = possibleSwipeCords.minY - diffMinY / 6;\n      } else if (this.isBeyondPossibleBottom(distance.y, possibleSwipeCords.maxY)) {\n        var diffMaxY = distance.y - possibleSwipeCords.maxY;\n        distance.y = possibleSwipeCords.maxY + diffMaxY / 6;\n      }\n    } else {\n      distance.y = this.top;\n    }\n\n    if (allowX) {\n      distance.x = this.left + (endCoords.x - startCoords.x);\n\n      if (this.isBeyondPossibleLeft(distance.x, possibleSwipeCords.minX)) {\n        var diffMinX = possibleSwipeCords.minX - distance.x;\n        distance.x = possibleSwipeCords.minX - diffMinX / 6;\n      } else if (this.isBeyondPossibleRight(distance.x, possibleSwipeCords.maxX)) {\n        var difMaxX = distance.x - possibleSwipeCords.maxX;\n        distance.x = possibleSwipeCords.maxX + difMaxX / 6;\n      }\n    } else {\n      distance.x = this.left;\n    }\n\n    return distance;\n  };\n\n  Zoom.prototype.isBeyondPossibleLeft = function (x, minX) {\n    return x >= minX;\n  };\n\n  Zoom.prototype.isBeyondPossibleRight = function (x, maxX) {\n    return x <= maxX;\n  };\n\n  Zoom.prototype.isBeyondPossibleTop = function (y, minY) {\n    return y >= minY;\n  };\n\n  Zoom.prototype.isBeyondPossibleBottom = function (y, maxY) {\n    return y <= maxY;\n  };\n\n  Zoom.prototype.isImageSlide = function () {\n    var currentItem = this.core.galleryItems[this.core.index];\n    return this.core.getSlideType(currentItem) === 'image';\n  };\n\n  Zoom.prototype.getPossibleSwipeDragCords = function (scale) {\n    var $image = this.core.getSlideItem(this.core.index).find('.lg-image').first();\n    var bottom = this.core.mediaContainerPosition.bottom;\n    var imgRect = $image.get().getBoundingClientRect();\n    var imageHeight = imgRect.height;\n    var imageWidth = imgRect.width;\n\n    if (scale) {\n      imageHeight = imageHeight + scale * imageHeight;\n      imageWidth = imageWidth + scale * imageWidth;\n    }\n\n    var minY = (imageHeight - this.containerRect.height) / 2;\n    var maxY = (this.containerRect.height - imageHeight) / 2 + bottom;\n    var minX = (imageWidth - this.containerRect.width) / 2;\n    var maxX = (this.containerRect.width - imageWidth) / 2;\n    var possibleSwipeCords = {\n      minY: minY,\n      maxY: maxY,\n      minX: minX,\n      maxX: maxX\n    };\n    return possibleSwipeCords;\n  };\n\n  Zoom.prototype.setZoomSwipeStyles = function (LGel, distance) {\n    LGel.css('transform', 'translate3d(' + distance.x + 'px, ' + distance.y + 'px, 0)');\n  };\n\n  Zoom.prototype.zoomSwipe = function () {\n    var _this = this;\n\n    var startCoords = {};\n    var endCoords = {};\n    var isMoved = false; // Allow x direction drag\n\n    var allowX = false; // Allow Y direction drag\n\n    var allowY = false;\n    var startTime = new Date();\n    var endTime = new Date();\n    var possibleSwipeCords;\n\n    var _LGel;\n\n    var $item = this.core.getSlideItem(this.core.index);\n    this.core.$inner.on('touchstart.lg', function (e) {\n      // Allow zoom only on image\n      if (!_this.isImageSlide()) {\n        return;\n      }\n\n      $item = _this.core.getSlideItem(_this.core.index);\n\n      if ((_this.$LG(e.target).hasClass('lg-item') || $item.get().contains(e.target)) && e.touches.length === 1 && _this.core.outer.hasClass('lg-zoomed')) {\n        e.preventDefault();\n        startTime = new Date();\n        _this.core.touchAction = 'zoomSwipe';\n        _LGel = _this.core.getSlideItem(_this.core.index).find('.lg-img-wrap').first();\n\n        var dragAllowedAxises = _this.getDragAllowedAxises(0);\n\n        allowY = dragAllowedAxises.allowY;\n        allowX = dragAllowedAxises.allowX;\n\n        if (allowX || allowY) {\n          startCoords = _this.getSwipeCords(e);\n        }\n\n        possibleSwipeCords = _this.getPossibleSwipeDragCords(); // reset opacity and transition duration\n\n        _this.core.outer.addClass('lg-zoom-dragging lg-zoom-drag-transition');\n      }\n    });\n    this.core.$inner.on('touchmove.lg', function (e) {\n      if (e.touches.length === 1 && _this.core.touchAction === 'zoomSwipe' && (_this.$LG(e.target).hasClass('lg-item') || $item.get().contains(e.target))) {\n        e.preventDefault();\n        _this.core.touchAction = 'zoomSwipe';\n        endCoords = _this.getSwipeCords(e);\n\n        var distance = _this.getZoomSwipeCords(startCoords, endCoords, allowX, allowY, possibleSwipeCords);\n\n        if (Math.abs(endCoords.x - startCoords.x) > 15 || Math.abs(endCoords.y - startCoords.y) > 15) {\n          isMoved = true;\n\n          _this.setZoomSwipeStyles(_LGel, distance);\n        }\n      }\n    });\n    this.core.$inner.on('touchend.lg', function (e) {\n      if (_this.core.touchAction === 'zoomSwipe' && (_this.$LG(e.target).hasClass('lg-item') || $item.get().contains(e.target))) {\n        e.preventDefault();\n        _this.core.touchAction = undefined;\n\n        _this.core.outer.removeClass('lg-zoom-dragging');\n\n        if (!isMoved) {\n          return;\n        }\n\n        isMoved = false;\n        endTime = new Date();\n        var touchDuration = endTime.valueOf() - startTime.valueOf();\n\n        _this.touchendZoom(startCoords, endCoords, allowX, allowY, touchDuration);\n      }\n    });\n  };\n\n  Zoom.prototype.zoomDrag = function () {\n    var _this = this;\n\n    var startCoords = {};\n    var endCoords = {};\n    var isDragging = false;\n    var isMoved = false; // Allow x direction drag\n\n    var allowX = false; // Allow Y direction drag\n\n    var allowY = false;\n    var startTime;\n    var endTime;\n    var possibleSwipeCords;\n\n    var _LGel;\n\n    this.core.outer.on('mousedown.lg.zoom', function (e) {\n      // Allow zoom only on image\n      if (!_this.isImageSlide()) {\n        return;\n      }\n\n      var $item = _this.core.getSlideItem(_this.core.index);\n\n      if (_this.$LG(e.target).hasClass('lg-item') || $item.get().contains(e.target)) {\n        startTime = new Date();\n        _LGel = _this.core.getSlideItem(_this.core.index).find('.lg-img-wrap').first();\n\n        var dragAllowedAxises = _this.getDragAllowedAxises(0);\n\n        allowY = dragAllowedAxises.allowY;\n        allowX = dragAllowedAxises.allowX;\n\n        if (_this.core.outer.hasClass('lg-zoomed')) {\n          if (_this.$LG(e.target).hasClass('lg-object') && (allowX || allowY)) {\n            e.preventDefault();\n            startCoords = _this.getDragCords(e);\n            possibleSwipeCords = _this.getPossibleSwipeDragCords();\n            isDragging = true;\n\n            _this.core.outer.removeClass('lg-grab').addClass('lg-grabbing lg-zoom-drag-transition lg-zoom-dragging'); // reset opacity and transition duration\n\n          }\n        }\n      }\n    });\n    this.$LG(window).on(\"mousemove.lg.zoom.global\" + this.core.lgId, function (e) {\n      if (isDragging) {\n        isMoved = true;\n        endCoords = _this.getDragCords(e);\n\n        var distance = _this.getZoomSwipeCords(startCoords, endCoords, allowX, allowY, possibleSwipeCords);\n\n        _this.setZoomSwipeStyles(_LGel, distance);\n      }\n    });\n    this.$LG(window).on(\"mouseup.lg.zoom.global\" + this.core.lgId, function (e) {\n      if (isDragging) {\n        endTime = new Date();\n        isDragging = false;\n\n        _this.core.outer.removeClass('lg-zoom-dragging'); // Fix for chrome mouse move on click\n\n\n        if (isMoved && (startCoords.x !== endCoords.x || startCoords.y !== endCoords.y)) {\n          endCoords = _this.getDragCords(e);\n          var touchDuration = endTime.valueOf() - startTime.valueOf();\n\n          _this.touchendZoom(startCoords, endCoords, allowX, allowY, touchDuration);\n        }\n\n        isMoved = false;\n      }\n\n      _this.core.outer.removeClass('lg-grabbing').addClass('lg-grab');\n    });\n  };\n\n  Zoom.prototype.closeGallery = function () {\n    this.resetZoom();\n  };\n\n  Zoom.prototype.destroy = function () {\n    // Unbind all events added by lightGallery zoom plugin\n    this.$LG(window).off(\".lg.zoom.global\" + this.core.lgId);\n    this.core.LGel.off('.lg.zoom');\n    this.core.LGel.off('.zoom');\n    clearTimeout(this.zoomableTimeout);\n    this.zoomableTimeout = false;\n  };\n\n  return Zoom;\n}();\n\nexport default Zoom;","map":{"version":3,"mappings":"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","names":["zoomSettings","scale","zoom","actualSize","showZoomInOutIcons","actualSizeIcons","zoomIn","zoomOut","enableZoomAfter","zoomPluginStrings","viewActualSize","lGEvents","afterAppendSlide","init","hasVideo","containerResize","updateSlides","afterAppendSubHtml","beforeOpen","afterOpen","slideItemLoad","beforeSlide","afterSlide","posterClick","dragStart","dragMove","dragEnd","beforeNextSlide","beforePrevSlide","beforeClose","afterClose","rotateLeft","rotateRight","flipHorizontal","flipVertical","autoplay","autoplayStart","autoplayStop","instance","$LG","core","settings","__assign","Zoom","zoomIcons","getIdName","outer","addClass","$toolbar","first","append","event","_speed","detail","delay","hasClass","removeClass","zoomableTimeout","setTimeout","_this","isImageSlide","getSlideItem","index","setZoomEssentials","LGel","on","enableZoom","bind","e","x","pageX","y","pageY","touches","scaleDiff","$image","find","get","height","width","rect","getBoundingClientRect","offsetHeight","offsetWidth","allowY","containerRect","allowX","$content","reposition","resetToMax","Math","abs","offsetX","left","offsetY","top","scrollTop","originalX","originalY","positionChanged","dragAllowedAxises","getDragAllowedAxises","possibleSwipeCords","getPossibleSwipeDragCords","_x","_y","scaleVal","isBeyondPossibleLeft","minX","isBeyondPossibleRight","maxX","isBeyondPossibleTop","minY","isBeyondPossibleBottom","maxY","setZoomStyles","actualSizeScale","getCurrentImageActualSizeScale","setZoomImageSize","imageReset","css","naturalWidth","naturalHeight","style","$imageWrap","$dummyImage","transform","currentItem","galleryItems","resetImageTranslate","src","prevScale","getScale","setPageCords","beginZoom","zoomImage","parseFloat","_scale","getNaturalWidth","getActualSizeScale","cords","pageCords","getPageCords","$actualSize","getElementById","manageActualPixelClassNames","resetZoom","buildTemplates","enableZoomOnSlideItemLoad","tapped","target","setActualSize","$target","length","clearTimeout","preventDefault","lgOpened","touchAction","_LGel","setZoomSwipeStyles","window","lgId","timeout","prevIndex","zoomDrag","pinchZoom","zoomSwipe","$item","undefined","removeAttr","sqrt","startDist","pinchStarted","initScale","getTouchDistance","$inner","contains","endDist","distance","max","round","Number","EPSILON","diff","startCoords","endCoords","touchDuration","distanceXnew","distanceYnew","speedX","speedY","diffMinY","diffMaxY","diffMinX","difMaxX","getSlideType","mediaContainerPosition","bottom","imgRect","imageHeight","imageWidth","isMoved","startTime","Date","endTime","getSwipeCords","getZoomSwipeCords","valueOf","touchendZoom","isDragging","getDragCords","off"],"sources":["../../../src/plugins/zoom/lg-zoom-settings.ts","../../../src/lg-events.ts","../../../src/plugins/zoom/lg-zoom.ts"],"sourcesContent":["export interface ActualSizeIcons {\n    zoomIn: 'lg-zoom-in' | 'lg-actual-size';\n    zoomOut: 'lg-zoom-out' | 'lg-actual-size';\n}\n\nexport interface ZoomStrings {\n    zoomIn: string;\n    zoomOut: string;\n    viewActualSize: string;\n}\n\nexport interface ZoomSettings {\n    /**\n     * Value of zoom should be incremented/decremented\n     */\n    scale: number;\n\n    /**\n     * Enable/Disable zoom option\n     */\n    zoom: boolean;\n\n    /**\n     * Enable actual size icon.\n     */\n    actualSize: boolean;\n\n    /**\n     * Once the slide transition is completed, how much time should take zoom plugin to activate\n     * @description Some css styles will be added to the images if zoom is enabled.\n     * So it might conflict if you add any custom styles to the images such as the initial transition while opening the gallery.\n     * So you can delay adding zoom related styles to the images by changing the value of enableZoomAfter.\n     */\n    enableZoomAfter: number;\n\n    /**\n     * Show zoom in, zoom out icons\n     */\n    showZoomInOutIcons: boolean;\n\n    /**\n     * Actual size icons classnames.\n     * Specify classnames for both ZoomIn and ZoomOut states\n     * You can use `actualSizeIcons: { zoomIn: 'lg-actual-size', zoomOut: 'lg-zoom-out' }`\n     * to show actual size icons instead of zoom in and zoom out icons.\n     */\n    actualSizeIcons: ActualSizeIcons;\n\n    /**\n     * Custom translation strings for aria-labels\n     */\n    zoomPluginStrings: ZoomStrings;\n}\n\nexport const zoomSettings: ZoomSettings = {\n    scale: 1,\n    zoom: true,\n    actualSize: true,\n    showZoomInOutIcons: false,\n    actualSizeIcons: {\n        zoomIn: 'lg-zoom-in',\n        zoomOut: 'lg-zoom-out',\n    } as ActualSizeIcons,\n    enableZoomAfter: 300,\n    zoomPluginStrings: {\n        zoomIn: 'Zoom in',\n        zoomOut: 'Zoom out',\n        viewActualSize: 'View actual size',\n    } as ZoomStrings,\n};\n","import { LightGallery } from './lightgallery';\nimport { VideoSource } from './plugins/video/types';\n\n/**\n * List of lightGallery events\n * All events should be documented here\n * Below interfaces are used to build the website documentations\n * */\nexport const lGEvents: {\n    [key: string]: string;\n} = {\n    afterAppendSlide: 'lgAfterAppendSlide',\n    init: 'lgInit',\n    hasVideo: 'lgHasVideo',\n    containerResize: 'lgContainerResize',\n    updateSlides: 'lgUpdateSlides',\n    afterAppendSubHtml: 'lgAfterAppendSubHtml',\n    beforeOpen: 'lgBeforeOpen',\n    afterOpen: 'lgAfterOpen',\n    slideItemLoad: 'lgSlideItemLoad',\n    beforeSlide: 'lgBeforeSlide',\n    afterSlide: 'lgAfterSlide',\n    posterClick: 'lgPosterClick',\n    dragStart: 'lgDragStart',\n    dragMove: 'lgDragMove',\n    dragEnd: 'lgDragEnd',\n    beforeNextSlide: 'lgBeforeNextSlide',\n    beforePrevSlide: 'lgBeforePrevSlide',\n    beforeClose: 'lgBeforeClose',\n    afterClose: 'lgAfterClose',\n    rotateLeft: 'lgRotateLeft',\n    rotateRight: 'lgRotateRight',\n    flipHorizontal: 'lgFlipHorizontal',\n    flipVertical: 'lgFlipVertical',\n    autoplay: 'lgAutoplay',\n    autoplayStart: 'lgAutoplayStart',\n    autoplayStop: 'lgAutoplayStop',\n};\n\n// Follow the below format for the event documentation\n// @method is the method name when event is used with Angular/React components\n\n/**\n * Fired only once when lightGallery is initialized\n * @name lgInit\n * @method onInit\n * @example\n *   const lg = document.getElementById('custom-events-demo');\n *   // Perform any action on lightGallery initialization.\n *   // Init event returns the plugin instance that can be used to call any lightGalley public method\n *   let pluginInstance = null;\n *   lg.addEventListener('lgInit', (event) => {\n *      pluginInstance = event.detail.instance;\n *   });\n *   lightGallery(lg);\n * @see <a href=\"/docs/methods\">Methods<a>\n */\nexport interface InitDetail {\n    /**\n     * lightGallery plugin instance\n     */\n    instance: LightGallery;\n}\n\n/**\n * Fired when the slide content has been inserted into it's slide container.\n * @name lgAfterAppendSlide\n * @method onAfterAppendSlide\n */\nexport interface AfterAppendSlideEventDetail {\n    /**\n     * Index of the slide\n     */\n    index: number;\n}\n\n/**\n * Fired immediately before opening the gallery\n * @name lgBeforeOpen\n * @method onBeforeOpen\n */\nexport interface BeforeOpenDetail {}\n\n/**\n * Fired immediately after opening the gallery\n * @name lgAfterOpen\n * @method onAfterOpen\n */\nexport interface AfterOpenDetail {}\n\n/**\n * Fired once the media inside the slide has been completely loaded .\n * @name lgSlideItemLoad\n * @method onSlideItemLoad\n */\nexport interface SlideItemLoadDetail {\n    /**\n     * Index of the slide\n     */\n    index: number;\n    /**\n     * For the first slide, lightGallery adds some delay for displaying the loaded slide item.\n     * This delay is required for the transition effect when the slide item is displayed\n     * Respect the delay when you use this event\n     */\n    delay: number;\n\n    // Will be true for the first slide\n    isFirstSlide: boolean;\n}\n\n/**\n * Fired immediately before each slide transition.\n * @name lgBeforeSlide\n * @method onBeforeSlide\n * @example\n *   const lg = document.getElementById('custom-events-demo');\n *   // Perform any action before each slide transition\n *   lg.addEventListener('lgBeforeSlide', (event) => {\n *       const { index, prevIndex } = event.detail;\n *       alert(index, prevIndex);\n *   });\n *   lightGallery(lg);\n */\nexport interface BeforeSlideDetail {\n    /**\n     * Index of the previous slide\n     */\n    prevIndex: number;\n    /**\n     * Index of the slide\n     */\n    index: number;\n    /**\n     * true if slide function called via touch event or mouse drag\n     */\n    fromTouch: boolean;\n    /**\n     * true if slide function called via thumbnail click\n     */\n    fromThumb: boolean;\n}\n\n/**\n * Fired immediately after each slide transition.\n * @name lgAfterSlide\n * @method onAfterSlide\n */\nexport interface AfterSlideDetail {\n    /**\n     * Index of the previous slide\n     */\n    prevIndex: number;\n    /**\n     * Index of the slide\n     */\n    index: number;\n    /**\n     * true if slide function called via touch event or mouse drag\n     */\n    fromTouch: boolean;\n    /**\n     * true if slide function called via thumbnail click\n     */\n    fromThumb: boolean;\n}\n\n/**\n * Fired when the video poster is clicked.\n * @name lgPosterClick\n * @method onPosterClick\n */\nexport interface PosterClickDetail {}\n\n/**\n * Fired when the drag event to move to different slide starts.\n * @name lgDragStart\n * @method onDragStart\n */\nexport interface DragStartDetail {}\n\n/**\n * Fired periodically during the drag operation.\n * @name lgDragMove\n * @method onDragMove\n */\nexport interface DragMoveDetail {}\n\n/**\n * Fired when the user has finished the drag operation\n * @name lgDragEnd\n * @method onDragEnd\n */\nexport interface DragEndDetail {}\n\n/**\n * Fired immediately before the start of the close process.\n * @name lgBeforeClose\n * @method onBeforeClose\n */\nexport interface BeforeCloseDetail {}\n\n/**\n * Fired immediately once lightGallery is closed.\n * @name lgAfterClose\n * @method onAfterClose\n */\nexport interface AfterCloseDetail {\n    /**\n     * lightGallery plugin instance\n     */\n    instance: LightGallery;\n}\n\n/**\n * Fired immediately before each \"next\" slide transition\n * @name lgBeforeNextSlide\n * @method onBeforeNextSlide\n */\nexport interface BeforeNextSlideDetail {\n    /**\n     * Index of the slide\n     */\n    index: number;\n    /**\n     * true if slide function called via touch event or mouse drag\n     */\n    fromTouch: boolean;\n}\n\n/**\n * Fired immediately before each \"prev\" slide transition\n * @name lgBeforePrevSlide\n * @method onBeforePrevSlide\n */\nexport interface BeforePrevSlideDetail {\n    /**\n     * Index of the slide\n     */\n    index: number;\n    /**\n     * true if slide function called via touch event or mouse drag\n     */\n    fromTouch: boolean;\n}\n\n/**\n * Fired when the sub-html content (ex : title/ description) has been appended into the slide.\n * @name lgAfterAppendSubHtml\n * @method onAfterAppendSubHtml\n */\nexport interface AfterAppendSubHtmlDetail {\n    /**\n     * Index of the slide\n     */\n    index: number;\n}\n\n/**\n * Fired when the lightGallery container has been resized.\n * @name lgContainerResize\n * @method onContainerResize\n */\nexport interface ContainerResizeDetail {\n    /**\n     * Index of the slide\n     */\n    index: number;\n}\n\n/**\n * Fired when lightGallery detects video slide\n * @name lgHasVideo\n * @method onHasVideo\n */\nexport interface HasVideoDetail {\n    /**\n     * Index of the slide,\n     */\n    index: number;\n    /**\n     * Video source\n     */\n    src: string;\n    /**\n     * HTML5 video source if available\n     * <p>\n       HTML5 video source = source: {\n            src: string;\n            type: string;\n        }[];\n        attributes: HTMLVideoElement;\n     * </p>\n     */\n    html5Video: VideoSource;\n    /**\n     * True if video has poster\n     */\n    hasPoster: boolean;\n}\n\n/**\n * Fired when the image is rotated in anticlockwise direction\n * @name lgRotateLeft\n * @method onRotateLeft\n */\nexport interface RotateLeftDetail {\n    /**\n     * Index of the slide\n     */\n    index: number;\n}\n\n/**\n * Fired when the image is rotated in clockwise direction\n * @name lgRotateRight\n * @method onRotateRight\n */\nexport interface RotateRightDetail {\n    /**\n     * Index of the slide\n     */\n    index: number;\n}\n\n/**\n * Fired when the image is flipped horizontally\n * @name lgFlipHorizontal\n * @method onFlipHorizontal\n */\nexport interface FlipHorizontalDetail {\n    /**\n     * Index of the slide\n     */\n    index: number;\n}\n\n/**\n * Fired when the image is flipped vertically\n * @name lgFlipVertical\n * @method onFlipVertical\n */\nexport interface FlipVerticalDetail {\n    /**\n     * Index of the slide\n     */\n    index: number;\n}\n","import { ZoomSettings, zoomSettings } from './lg-zoom-settings';\nimport { LgQuery, lgQuery } from '../../lgQuery';\nimport { LightGallery } from '../../lightgallery';\nimport { lGEvents } from '../../lg-events';\n\ninterface Coords {\n    x: number;\n    y: number;\n}\n\ninterface DragAllowedAxises {\n    allowX: boolean;\n    allowY: boolean;\n}\ninterface ZoomTouchEvent {\n    pageX: number;\n    touches: { pageY: number; pageX: number }[];\n    pageY: number;\n}\ninterface PossibleCords {\n    minX: number;\n    minY: number;\n    maxX: number;\n    maxY: number;\n}\nexport default class Zoom {\n    private core: LightGallery;\n    private settings: ZoomSettings;\n    private $LG!: LgQuery;\n    private imageReset!: number | boolean;\n    zoomableTimeout: any;\n    positionChanged!: boolean;\n    pageX!: number;\n    pageY!: number;\n    scale!: number;\n\n    containerRect!: ClientRect;\n    dragAllowedAxises!: DragAllowedAxises;\n    top!: number;\n    left!: number;\n    scrollTop!: number;\n    constructor(instance: LightGallery, $LG: LgQuery) {\n        // get lightGallery core plugin instance\n        this.core = instance;\n        this.$LG = $LG;\n\n        this.settings = { ...zoomSettings, ...this.core.settings };\n\n        return this;\n    }\n\n    // Append Zoom controls. Actual size, Zoom-in, Zoom-out\n    buildTemplates(): void {\n        let zoomIcons = this.settings.showZoomInOutIcons\n            ? `<button id=\"${this.core.getIdName(\n                  'lg-zoom-in',\n              )}\" type=\"button\" aria-label=\"${\n                  this.settings.zoomPluginStrings['zoomIn']\n              }\" class=\"lg-zoom-in lg-icon\"></button><button id=\"${this.core.getIdName(\n                  'lg-zoom-out',\n              )}\" type=\"button\" aria-label=\"${\n                  this.settings.zoomPluginStrings['zoomIn']\n              }\" class=\"lg-zoom-out lg-icon\"></button>`\n            : '';\n\n        if (this.settings.actualSize) {\n            zoomIcons += `<button id=\"${this.core.getIdName(\n                'lg-actual-size',\n            )}\" type=\"button\" aria-label=\"${\n                this.settings.zoomPluginStrings['viewActualSize']\n            }\" class=\"${\n                this.settings.actualSizeIcons.zoomIn\n            } lg-icon\"></button>`;\n        }\n\n        this.core.outer.addClass('lg-use-transition-for-zoom');\n\n        this.core.$toolbar.first().append(zoomIcons);\n    }\n\n    /**\n     * @desc Enable zoom option only once the image is completely loaded\n     * If zoomFromOrigin is true, Zoom is enabled once the dummy image has been inserted\n     *\n     * Zoom styles are defined under lg-zoomable CSS class.\n     */\n    enableZoom(event: CustomEvent): void {\n        // delay will be 0 except first time\n        let _speed = this.settings.enableZoomAfter + event.detail.delay;\n\n        // set _speed value 0 if gallery opened from direct url and if it is first slide\n        if (\n            this.$LG('body').first().hasClass('lg-from-hash') &&\n            event.detail.delay\n        ) {\n            // will execute only once\n            _speed = 0;\n        } else {\n            // Remove lg-from-hash to enable starting animation.\n            this.$LG('body').first().removeClass('lg-from-hash');\n        }\n\n        this.zoomableTimeout = setTimeout(() => {\n            if (!this.isImageSlide()) {\n                return;\n            }\n            this.core.getSlideItem(event.detail.index).addClass('lg-zoomable');\n            if (event.detail.index === this.core.index) {\n                this.setZoomEssentials();\n            }\n        }, _speed + 30);\n    }\n\n    enableZoomOnSlideItemLoad(): void {\n        // Add zoomable class\n        this.core.LGel.on(\n            `${lGEvents.slideItemLoad}.zoom`,\n            this.enableZoom.bind(this),\n        );\n    }\n\n    getDragCords(e: MouseEvent): Coords {\n        return {\n            x: e.pageX,\n            y: e.pageY,\n        };\n    }\n    getSwipeCords(e: TouchEvent): Coords {\n        const x = e.touches[0].pageX;\n        const y = e.touches[0].pageY;\n        return {\n            x,\n            y,\n        };\n    }\n\n    getDragAllowedAxises(scale: number, scaleDiff?: number): DragAllowedAxises {\n        const $image = this.core\n            .getSlideItem(this.core.index)\n            .find('.lg-image')\n            .first()\n            .get();\n\n        let height = 0;\n        let width = 0;\n        const rect = $image.getBoundingClientRect();\n        if (scale) {\n            height = $image.offsetHeight * scale;\n            width = $image.offsetWidth * scale;\n        } else if (scaleDiff) {\n            height = rect.height + scaleDiff * rect.height;\n            width = rect.width + scaleDiff * rect.width;\n        } else {\n            height = rect.height;\n            width = rect.width;\n        }\n        const allowY = height > this.containerRect.height;\n        const allowX = width > this.containerRect.width;\n        return {\n            allowX,\n            allowY,\n        };\n    }\n\n    setZoomEssentials(): void {\n        this.containerRect = this.core.$content.get().getBoundingClientRect();\n    }\n\n    /**\n     * @desc Image zoom\n     * Translate the wrap and scale the image to get better user experience\n     *\n     * @param {String} scale - Zoom decrement/increment value\n     */\n    zoomImage(\n        scale: number,\n        scaleDiff: number,\n        reposition: boolean,\n        resetToMax: boolean,\n    ): void {\n        if (Math.abs(scaleDiff) <= 0) return;\n\n        const offsetX = this.containerRect.width / 2 + this.containerRect.left;\n\n        const offsetY =\n            this.containerRect.height / 2 +\n            this.containerRect.top +\n            this.scrollTop;\n\n        let originalX;\n        let originalY;\n\n        if (scale === 1) {\n            this.positionChanged = false;\n        }\n\n        const dragAllowedAxises = this.getDragAllowedAxises(0, scaleDiff);\n\n        const { allowY, allowX } = dragAllowedAxises;\n        if (this.positionChanged) {\n            originalX = this.left / (this.scale - scaleDiff);\n            originalY = this.top / (this.scale - scaleDiff);\n            this.pageX = offsetX - originalX;\n            this.pageY = offsetY - originalY;\n\n            this.positionChanged = false;\n        }\n\n        const possibleSwipeCords = this.getPossibleSwipeDragCords(scaleDiff);\n\n        let x;\n        let y;\n        let _x = offsetX - this.pageX;\n        let _y = offsetY - this.pageY;\n\n        if (scale - scaleDiff > 1) {\n            const scaleVal = (scale - scaleDiff) / Math.abs(scaleDiff);\n            _x =\n                (scaleDiff < 0 ? -_x : _x) +\n                this.left * (scaleVal + (scaleDiff < 0 ? -1 : 1));\n            _y =\n                (scaleDiff < 0 ? -_y : _y) +\n                this.top * (scaleVal + (scaleDiff < 0 ? -1 : 1));\n            x = _x / scaleVal;\n            y = _y / scaleVal;\n        } else {\n            const scaleVal = (scale - scaleDiff) * scaleDiff;\n            x = _x * scaleVal;\n            y = _y * scaleVal;\n        }\n\n        if (reposition) {\n            if (allowX) {\n                if (this.isBeyondPossibleLeft(x, possibleSwipeCords.minX)) {\n                    x = possibleSwipeCords.minX;\n                } else if (\n                    this.isBeyondPossibleRight(x, possibleSwipeCords.maxX)\n                ) {\n                    x = possibleSwipeCords.maxX;\n                }\n            } else {\n                if (scale > 1) {\n                    if (x < possibleSwipeCords.minX) {\n                        x = possibleSwipeCords.minX;\n                    } else if (x > possibleSwipeCords.maxX) {\n                        x = possibleSwipeCords.maxX;\n                    }\n                }\n            }\n            // @todo fix this\n            if (allowY) {\n                if (this.isBeyondPossibleTop(y, possibleSwipeCords.minY)) {\n                    y = possibleSwipeCords.minY;\n                } else if (\n                    this.isBeyondPossibleBottom(y, possibleSwipeCords.maxY)\n                ) {\n                    y = possibleSwipeCords.maxY;\n                }\n            } else {\n                // If the translate value based on index of beyond the viewport, utilize the available space to prevent image being cut out\n                if (scale > 1) {\n                    //If image goes beyond viewport top, use the minim possible translate value\n                    if (y < possibleSwipeCords.minY) {\n                        y = possibleSwipeCords.minY;\n                    } else if (y > possibleSwipeCords.maxY) {\n                        y = possibleSwipeCords.maxY;\n                    }\n                }\n            }\n        }\n\n        this.setZoomStyles({\n            x: x,\n            y: y,\n            scale,\n        });\n\n        this.left = x;\n        this.top = y;\n\n        if (resetToMax) {\n            const actualSizeScale = this.getCurrentImageActualSizeScale();\n\n            if (scale >= actualSizeScale) {\n                this.setZoomImageSize();\n            }\n        }\n    }\n\n    resetImageTranslate(): void {\n        const $image = this.core\n            .getSlideItem(this.core.index)\n            .find('.lg-image')\n            .first();\n        this.imageReset = false;\n        $image.removeClass(\n            'reset-transition reset-transition-y reset-transition-x',\n        );\n        this.core.outer.removeClass('lg-actual-size');\n        $image.css('width', 'auto').css('height', 'auto');\n        setTimeout(() => {\n            $image.removeClass('no-transition');\n        }, 10);\n    }\n\n    setZoomImageSize(): void {\n        const $image = this.core\n            .getSlideItem(this.core.index)\n            .find('.lg-image')\n            .first();\n\n        setTimeout(() => {\n            $image.addClass('no-transition');\n            this.imageReset = true;\n        }, 500);\n        setTimeout(() => {\n            const dragAllowedAxises = this.getDragAllowedAxises(this.scale);\n\n            $image\n                .css(\n                    'width',\n                    ($image.get() as HTMLImageElement).naturalWidth + 'px',\n                )\n                .css(\n                    'height',\n                    ($image.get() as HTMLImageElement).naturalHeight + 'px',\n                );\n            this.core.outer.addClass('lg-actual-size');\n            if (dragAllowedAxises.allowX && dragAllowedAxises.allowY) {\n                $image.addClass('reset-transition');\n            } else if (dragAllowedAxises.allowX && !dragAllowedAxises.allowY) {\n                $image.addClass('reset-transition-x');\n            } else if (!dragAllowedAxises.allowX && dragAllowedAxises.allowY) {\n                $image.addClass('reset-transition-y');\n            }\n        }, 550);\n    }\n\n    /**\n     * @desc apply scale3d to image and translate to image wrap\n     * @param {style} X,Y and scale\n     */\n    setZoomStyles(style: { x: number; y: number; scale: number }): void {\n        const $imageWrap = this.core\n            .getSlideItem(this.core.index)\n            .find('.lg-img-wrap')\n            .first();\n        const $image = this.core\n            .getSlideItem(this.core.index)\n            .find('.lg-image')\n            .first();\n        const $dummyImage = this.core.outer\n            .find('.lg-current .lg-dummy-img')\n            .first();\n        this.scale = style.scale;\n        $image.css(\n            'transform',\n            'scale3d(' + style.scale + ', ' + style.scale + ', 1)',\n        );\n\n        $dummyImage.css(\n            'transform',\n            'scale3d(' + style.scale + ', ' + style.scale + ', 1)',\n        );\n\n        const transform =\n            'translate3d(' + style.x + 'px, ' + style.y + 'px, 0)';\n        $imageWrap.css('transform', transform);\n    }\n\n    /**\n     * @param index - Index of the current slide\n     * @param event - event will be available only if the function is called on clicking/taping the imags\n     */\n    setActualSize(index: number, event?: ZoomTouchEvent): void {\n        const currentItem = this.core.galleryItems[this.core.index];\n        this.resetImageTranslate();\n        setTimeout(() => {\n            // Allow zoom only on image\n            if (\n                !currentItem.src ||\n                this.core.outer.hasClass('lg-first-slide-loading')\n            ) {\n                return;\n            }\n            const scale = this.getCurrentImageActualSizeScale();\n            const prevScale = this.scale;\n            if (this.core.outer.hasClass('lg-zoomed')) {\n                this.scale = 1;\n            } else {\n                this.scale = this.getScale(scale);\n            }\n            this.setPageCords(event);\n\n            this.beginZoom(this.scale);\n            this.zoomImage(this.scale, this.scale - prevScale, true, true);\n\n            setTimeout(() => {\n                this.core.outer.removeClass('lg-grabbing').addClass('lg-grab');\n            }, 10);\n        }, 50);\n    }\n\n    getNaturalWidth(index: number): number {\n        const $image = this.core.getSlideItem(index).find('.lg-image').first();\n\n        const naturalWidth = this.core.galleryItems[index].width;\n        return naturalWidth\n            ? parseFloat(naturalWidth)\n            : undefined || ($image.get() as any).naturalWidth;\n    }\n\n    getActualSizeScale(naturalWidth: number, width: number): number {\n        let _scale;\n        let scale;\n        if (naturalWidth >= width) {\n            _scale = naturalWidth / width;\n            scale = _scale || 2;\n        } else {\n            scale = 1;\n        }\n        return scale;\n    }\n\n    getCurrentImageActualSizeScale(): number {\n        const $image = this.core\n            .getSlideItem(this.core.index)\n            .find('.lg-image')\n            .first();\n        const width = $image.get().offsetWidth;\n        const naturalWidth = this.getNaturalWidth(this.core.index) || width;\n        return this.getActualSizeScale(naturalWidth, width);\n    }\n\n    getPageCords(event?: ZoomTouchEvent): Coords {\n        const cords: Coords = {} as Coords;\n        if (event) {\n            cords.x = event.pageX || event.touches[0].pageX;\n            cords.y = event.pageY || event.touches[0].pageY;\n        } else {\n            const containerRect = this.core.$content\n                .get()\n                .getBoundingClientRect();\n            cords.x = containerRect.width / 2 + containerRect.left;\n            cords.y =\n                containerRect.height / 2 + this.scrollTop + containerRect.top;\n        }\n        return cords;\n    }\n\n    setPageCords(event?: ZoomTouchEvent): void {\n        const pageCords = this.getPageCords(event);\n\n        this.pageX = pageCords.x;\n        this.pageY = pageCords.y;\n    }\n\n    manageActualPixelClassNames(): void {\n        const $actualSize = this.core.getElementById('lg-actual-size');\n        $actualSize\n            .removeClass(this.settings.actualSizeIcons.zoomIn)\n            .addClass(this.settings.actualSizeIcons.zoomOut);\n    }\n\n    // If true, zoomed - in else zoomed out\n    beginZoom(scale: number): boolean {\n        this.core.outer.removeClass('lg-zoom-drag-transition lg-zoom-dragging');\n        if (scale > 1) {\n            this.core.outer.addClass('lg-zoomed');\n            this.manageActualPixelClassNames();\n        } else {\n            this.resetZoom();\n        }\n        return scale > 1;\n    }\n\n    getScale(scale: number): number {\n        const actualSizeScale = this.getCurrentImageActualSizeScale();\n        if (scale < 1) {\n            scale = 1;\n        } else if (scale > actualSizeScale) {\n            scale = actualSizeScale;\n        }\n        return scale;\n    }\n\n    init(): void {\n        if (!this.settings.zoom) {\n            return;\n        }\n        this.buildTemplates();\n        this.enableZoomOnSlideItemLoad();\n\n        let tapped: ReturnType<typeof setTimeout> | null = null;\n\n        this.core.outer.on('dblclick.lg', (event) => {\n            if (!this.$LG(event.target).hasClass('lg-image')) {\n                return;\n            }\n            this.setActualSize(this.core.index, event);\n        });\n\n        this.core.outer.on('touchstart.lg', (event) => {\n            const $target = this.$LG(event.target);\n            if (event.touches.length === 1 && $target.hasClass('lg-image')) {\n                if (!tapped) {\n                    tapped = setTimeout(() => {\n                        tapped = null;\n                    }, 300);\n                } else {\n                    clearTimeout(tapped);\n                    tapped = null;\n                    event.preventDefault();\n                    this.setActualSize(this.core.index, event);\n                }\n            }\n        });\n\n        this.core.LGel.on(\n            `${lGEvents.containerResize}.zoom ${lGEvents.rotateRight}.zoom ${lGEvents.rotateLeft}.zoom ${lGEvents.flipHorizontal}.zoom ${lGEvents.flipVertical}.zoom`,\n            () => {\n                if (\n                    !this.core.lgOpened ||\n                    !this.isImageSlide() ||\n                    this.core.touchAction\n                ) {\n                    return;\n                }\n                const _LGel = this.core\n                    .getSlideItem(this.core.index)\n                    .find('.lg-img-wrap')\n                    .first();\n                this.top = 0;\n                this.left = 0;\n                this.setZoomEssentials();\n                this.setZoomSwipeStyles(_LGel, { x: 0, y: 0 });\n                this.positionChanged = true;\n            },\n        );\n        // Update zoom on resize and orientationchange\n        this.$LG(window).on(`scroll.lg.zoom.global${this.core.lgId}`, () => {\n            if (!this.core.lgOpened) return;\n            this.scrollTop = this.$LG(window).scrollTop();\n        });\n\n        this.core.getElementById('lg-zoom-out').on('click.lg', () => {\n            // Allow zoom only on image\n            if (!this.isImageSlide()) {\n                return;\n            }\n\n            let timeout = 0;\n            if (this.imageReset) {\n                this.resetImageTranslate();\n                timeout = 50;\n            }\n            setTimeout(() => {\n                let scale = this.scale - this.settings.scale;\n\n                if (scale < 1) {\n                    scale = 1;\n                }\n                this.beginZoom(scale);\n                this.zoomImage(scale, -this.settings.scale, true, true);\n            }, timeout);\n        });\n\n        this.core.getElementById('lg-zoom-in').on('click.lg', () => {\n            this.zoomIn();\n        });\n\n        this.core.getElementById('lg-actual-size').on('click.lg', () => {\n            this.setActualSize(this.core.index);\n        });\n\n        this.core.LGel.on(`${lGEvents.beforeOpen}.zoom`, () => {\n            this.core.outer.find('.lg-item').removeClass('lg-zoomable');\n        });\n        this.core.LGel.on(`${lGEvents.afterOpen}.zoom`, () => {\n            this.scrollTop = this.$LG(window).scrollTop();\n\n            // Set the initial value center\n            this.pageX = this.core.outer.width() / 2;\n            this.pageY = this.core.outer.height() / 2 + this.scrollTop;\n\n            this.scale = 1;\n        });\n\n        // Reset zoom on slide change\n        this.core.LGel.on(\n            `${lGEvents.afterSlide}.zoom`,\n            (event: CustomEvent) => {\n                const { prevIndex } = event.detail;\n                this.scale = 1;\n                this.positionChanged = false;\n                this.resetZoom(prevIndex);\n                if (this.isImageSlide()) {\n                    this.setZoomEssentials();\n                }\n            },\n        );\n\n        // Drag option after zoom\n        this.zoomDrag();\n\n        this.pinchZoom();\n\n        this.zoomSwipe();\n\n        // Store the zoomable timeout value just to clear it while closing\n        this.zoomableTimeout = false;\n        this.positionChanged = false;\n    }\n\n    zoomIn(): void {\n        // Allow zoom only on image\n        if (!this.isImageSlide()) {\n            return;\n        }\n\n        let scale = this.scale + this.settings.scale;\n\n        scale = this.getScale(scale);\n        this.beginZoom(scale);\n        this.zoomImage(scale, this.settings.scale, true, true);\n    }\n\n    // Reset zoom effect\n    resetZoom(index?: number): void {\n        this.core.outer.removeClass('lg-zoomed lg-zoom-drag-transition');\n        const $actualSize = this.core.getElementById('lg-actual-size');\n        const $item = this.core.getSlideItem(\n            index !== undefined ? index : this.core.index,\n        );\n        $actualSize\n            .removeClass(this.settings.actualSizeIcons.zoomOut)\n            .addClass(this.settings.actualSizeIcons.zoomIn);\n        $item.find('.lg-img-wrap').first().removeAttr('style');\n        $item.find('.lg-image').first().removeAttr('style');\n        this.scale = 1;\n        this.left = 0;\n        this.top = 0;\n\n        // Reset pagx pagy values to center\n        this.setPageCords();\n    }\n\n    getTouchDistance(e: TouchEvent): number {\n        return Math.sqrt(\n            (e.touches[0].pageX - e.touches[1].pageX) *\n                (e.touches[0].pageX - e.touches[1].pageX) +\n                (e.touches[0].pageY - e.touches[1].pageY) *\n                    (e.touches[0].pageY - e.touches[1].pageY),\n        );\n    }\n\n    pinchZoom(): void {\n        let startDist = 0;\n        let pinchStarted = false;\n        let initScale = 1;\n        let prevScale = 0;\n\n        let $item = this.core.getSlideItem(this.core.index);\n\n        this.core.outer.on('touchstart.lg', (e) => {\n            $item = this.core.getSlideItem(this.core.index);\n            if (!this.isImageSlide()) {\n                return;\n            }\n            if (e.touches.length === 2) {\n                e.preventDefault();\n                if (this.core.outer.hasClass('lg-first-slide-loading')) {\n                    return;\n                }\n                initScale = this.scale || 1;\n                this.core.outer.removeClass(\n                    'lg-zoom-drag-transition lg-zoom-dragging',\n                );\n\n                this.setPageCords(e);\n                this.resetImageTranslate();\n\n                this.core.touchAction = 'pinch';\n\n                startDist = this.getTouchDistance(e);\n            }\n        });\n\n        this.core.$inner.on('touchmove.lg', (e) => {\n            if (\n                e.touches.length === 2 &&\n                this.core.touchAction === 'pinch' &&\n                (this.$LG(e.target).hasClass('lg-item') ||\n                    $item.get().contains(e.target))\n            ) {\n                e.preventDefault();\n                const endDist = this.getTouchDistance(e);\n\n                const distance = startDist - endDist;\n                if (!pinchStarted && Math.abs(distance) > 5) {\n                    pinchStarted = true;\n                }\n                if (pinchStarted) {\n                    prevScale = this.scale;\n                    const _scale = Math.max(1, initScale + -distance * 0.02);\n                    this.scale =\n                        Math.round((_scale + Number.EPSILON) * 100) / 100;\n                    const diff = this.scale - prevScale;\n                    this.zoomImage(\n                        this.scale,\n                        Math.round((diff + Number.EPSILON) * 100) / 100,\n                        false,\n                        false,\n                    );\n                }\n            }\n        });\n\n        this.core.$inner.on('touchend.lg', (e) => {\n            if (\n                this.core.touchAction === 'pinch' &&\n                (this.$LG(e.target).hasClass('lg-item') ||\n                    $item.get().contains(e.target))\n            ) {\n                pinchStarted = false;\n                startDist = 0;\n                if (this.scale <= 1) {\n                    this.resetZoom();\n                } else {\n                    const actualSizeScale = this.getCurrentImageActualSizeScale();\n\n                    if (this.scale >= actualSizeScale) {\n                        let scaleDiff = actualSizeScale - this.scale;\n                        if (scaleDiff === 0) {\n                            scaleDiff = 0.01;\n                        }\n                        this.zoomImage(actualSizeScale, scaleDiff, false, true);\n                    }\n                    this.manageActualPixelClassNames();\n\n                    this.core.outer.addClass('lg-zoomed');\n                }\n                this.core.touchAction = undefined;\n            }\n        });\n    }\n\n    touchendZoom(\n        startCoords: Coords,\n        endCoords: Coords,\n        allowX: boolean,\n        allowY: boolean,\n        touchDuration: number,\n    ): void {\n        let distanceXnew = endCoords.x - startCoords.x;\n        let distanceYnew = endCoords.y - startCoords.y;\n\n        let speedX = Math.abs(distanceXnew) / touchDuration + 1;\n        let speedY = Math.abs(distanceYnew) / touchDuration + 1;\n\n        if (speedX > 2) {\n            speedX += 1;\n        }\n\n        if (speedY > 2) {\n            speedY += 1;\n        }\n\n        distanceXnew = distanceXnew * speedX;\n        distanceYnew = distanceYnew * speedY;\n\n        const _LGel = this.core\n            .getSlideItem(this.core.index)\n            .find('.lg-img-wrap')\n            .first();\n        const distance: Coords = {} as Coords;\n\n        distance.x = this.left + distanceXnew;\n        distance.y = this.top + distanceYnew;\n\n        const possibleSwipeCords = this.getPossibleSwipeDragCords();\n\n        if (Math.abs(distanceXnew) > 15 || Math.abs(distanceYnew) > 15) {\n            if (allowY) {\n                if (\n                    this.isBeyondPossibleTop(\n                        distance.y,\n                        possibleSwipeCords.minY,\n                    )\n                ) {\n                    distance.y = possibleSwipeCords.minY;\n                } else if (\n                    this.isBeyondPossibleBottom(\n                        distance.y,\n                        possibleSwipeCords.maxY,\n                    )\n                ) {\n                    distance.y = possibleSwipeCords.maxY;\n                }\n            }\n\n            if (allowX) {\n                if (\n                    this.isBeyondPossibleLeft(\n                        distance.x,\n                        possibleSwipeCords.minX,\n                    )\n                ) {\n                    distance.x = possibleSwipeCords.minX;\n                } else if (\n                    this.isBeyondPossibleRight(\n                        distance.x,\n                        possibleSwipeCords.maxX,\n                    )\n                ) {\n                    distance.x = possibleSwipeCords.maxX;\n                }\n            }\n\n            if (allowY) {\n                this.top = distance.y;\n            } else {\n                distance.y = this.top;\n            }\n\n            if (allowX) {\n                this.left = distance.x;\n            } else {\n                distance.x = this.left;\n            }\n\n            this.setZoomSwipeStyles(_LGel, distance);\n\n            this.positionChanged = true;\n        }\n    }\n\n    getZoomSwipeCords(\n        startCoords: Coords,\n        endCoords: Coords,\n        allowX: boolean,\n        allowY: boolean,\n        possibleSwipeCords: PossibleCords,\n    ): Coords {\n        const distance: Coords = {} as Coords;\n        if (allowY) {\n            distance.y = this.top + (endCoords.y - startCoords.y);\n            if (this.isBeyondPossibleTop(distance.y, possibleSwipeCords.minY)) {\n                const diffMinY = possibleSwipeCords.minY - distance.y;\n                distance.y = possibleSwipeCords.minY - diffMinY / 6;\n            } else if (\n                this.isBeyondPossibleBottom(distance.y, possibleSwipeCords.maxY)\n            ) {\n                const diffMaxY = distance.y - possibleSwipeCords.maxY;\n                distance.y = possibleSwipeCords.maxY + diffMaxY / 6;\n            }\n        } else {\n            distance.y = this.top;\n        }\n\n        if (allowX) {\n            distance.x = this.left + (endCoords.x - startCoords.x);\n            if (\n                this.isBeyondPossibleLeft(distance.x, possibleSwipeCords.minX)\n            ) {\n                const diffMinX = possibleSwipeCords.minX - distance.x;\n                distance.x = possibleSwipeCords.minX - diffMinX / 6;\n            } else if (\n                this.isBeyondPossibleRight(distance.x, possibleSwipeCords.maxX)\n            ) {\n                const difMaxX = distance.x - possibleSwipeCords.maxX;\n                distance.x = possibleSwipeCords.maxX + difMaxX / 6;\n            }\n        } else {\n            distance.x = this.left;\n        }\n\n        return distance;\n    }\n\n    private isBeyondPossibleLeft(x: number, minX: number) {\n        return x >= minX;\n    }\n    private isBeyondPossibleRight(x: number, maxX: number) {\n        return x <= maxX;\n    }\n    private isBeyondPossibleTop(y: number, minY: number) {\n        return y >= minY;\n    }\n    private isBeyondPossibleBottom(y: number, maxY: number) {\n        return y <= maxY;\n    }\n\n    isImageSlide(): boolean {\n        const currentItem = this.core.galleryItems[this.core.index];\n        return this.core.getSlideType(currentItem) === 'image';\n    }\n\n    getPossibleSwipeDragCords(scale?: number): PossibleCords {\n        const $image = this.core\n            .getSlideItem(this.core.index)\n            .find('.lg-image')\n            .first();\n\n        const { bottom } = this.core.mediaContainerPosition;\n\n        const imgRect = $image.get().getBoundingClientRect();\n\n        let imageHeight = imgRect.height;\n        let imageWidth = imgRect.width;\n\n        if (scale) {\n            imageHeight = imageHeight + scale * imageHeight;\n            imageWidth = imageWidth + scale * imageWidth;\n        }\n\n        const minY = (imageHeight - this.containerRect.height) / 2;\n        const maxY = (this.containerRect.height - imageHeight) / 2 + bottom;\n\n        const minX = (imageWidth - this.containerRect.width) / 2;\n\n        const maxX = (this.containerRect.width - imageWidth) / 2;\n\n        const possibleSwipeCords = {\n            minY: minY,\n            maxY: maxY,\n            minX: minX,\n            maxX: maxX,\n        };\n        return possibleSwipeCords;\n    }\n\n    setZoomSwipeStyles(\n        LGel: lgQuery,\n        distance: { x: number; y: number },\n    ): void {\n        LGel.css(\n            'transform',\n            'translate3d(' + distance.x + 'px, ' + distance.y + 'px, 0)',\n        );\n    }\n\n    zoomSwipe(): void {\n        let startCoords = {} as Coords;\n        let endCoords = {} as Coords;\n        let isMoved = false;\n\n        // Allow x direction drag\n        let allowX = false;\n\n        // Allow Y direction drag\n        let allowY = false;\n\n        let startTime: Date = new Date();\n        let endTime: Date = new Date();\n        let possibleSwipeCords: PossibleCords;\n\n        let _LGel: lgQuery;\n\n        let $item = this.core.getSlideItem(this.core.index);\n\n        this.core.$inner.on('touchstart.lg', (e) => {\n            // Allow zoom only on image\n            if (!this.isImageSlide()) {\n                return;\n            }\n            $item = this.core.getSlideItem(this.core.index);\n            if (\n                (this.$LG(e.target).hasClass('lg-item') ||\n                    $item.get().contains(e.target)) &&\n                e.touches.length === 1 &&\n                this.core.outer.hasClass('lg-zoomed')\n            ) {\n                e.preventDefault();\n                startTime = new Date();\n                this.core.touchAction = 'zoomSwipe';\n                _LGel = this.core\n                    .getSlideItem(this.core.index)\n                    .find('.lg-img-wrap')\n                    .first();\n\n                const dragAllowedAxises = this.getDragAllowedAxises(0);\n\n                allowY = dragAllowedAxises.allowY;\n                allowX = dragAllowedAxises.allowX;\n                if (allowX || allowY) {\n                    startCoords = this.getSwipeCords(e);\n                }\n\n                possibleSwipeCords = this.getPossibleSwipeDragCords();\n\n                // reset opacity and transition duration\n                this.core.outer.addClass(\n                    'lg-zoom-dragging lg-zoom-drag-transition',\n                );\n            }\n        });\n\n        this.core.$inner.on('touchmove.lg', (e) => {\n            if (\n                e.touches.length === 1 &&\n                this.core.touchAction === 'zoomSwipe' &&\n                (this.$LG(e.target).hasClass('lg-item') ||\n                    $item.get().contains(e.target))\n            ) {\n                e.preventDefault();\n                this.core.touchAction = 'zoomSwipe';\n\n                endCoords = this.getSwipeCords(e);\n\n                const distance = this.getZoomSwipeCords(\n                    startCoords,\n                    endCoords,\n                    allowX,\n                    allowY,\n                    possibleSwipeCords,\n                );\n\n                if (\n                    Math.abs(endCoords.x - startCoords.x) > 15 ||\n                    Math.abs(endCoords.y - startCoords.y) > 15\n                ) {\n                    isMoved = true;\n                    this.setZoomSwipeStyles(_LGel, distance);\n                }\n            }\n        });\n\n        this.core.$inner.on('touchend.lg', (e) => {\n            if (\n                this.core.touchAction === 'zoomSwipe' &&\n                (this.$LG(e.target).hasClass('lg-item') ||\n                    $item.get().contains(e.target))\n            ) {\n                e.preventDefault();\n                this.core.touchAction = undefined;\n                this.core.outer.removeClass('lg-zoom-dragging');\n                if (!isMoved) {\n                    return;\n                }\n                isMoved = false;\n                endTime = new Date();\n                const touchDuration = endTime.valueOf() - startTime.valueOf();\n                this.touchendZoom(\n                    startCoords,\n                    endCoords,\n                    allowX,\n                    allowY,\n                    touchDuration,\n                );\n            }\n        });\n    }\n\n    zoomDrag(): void {\n        let startCoords: Coords = {} as Coords;\n        let endCoords: Coords = {} as Coords;\n        let isDragging = false;\n        let isMoved = false;\n\n        // Allow x direction drag\n        let allowX = false;\n\n        // Allow Y direction drag\n        let allowY = false;\n\n        let startTime: number | Date;\n        let endTime;\n\n        let possibleSwipeCords: PossibleCords;\n\n        let _LGel: lgQuery;\n\n        this.core.outer.on('mousedown.lg.zoom', (e) => {\n            // Allow zoom only on image\n            if (!this.isImageSlide()) {\n                return;\n            }\n            const $item = this.core.getSlideItem(this.core.index);\n            if (\n                this.$LG(e.target).hasClass('lg-item') ||\n                $item.get().contains(e.target)\n            ) {\n                startTime = new Date();\n                _LGel = this.core\n                    .getSlideItem(this.core.index)\n                    .find('.lg-img-wrap')\n                    .first();\n\n                const dragAllowedAxises = this.getDragAllowedAxises(0);\n\n                allowY = dragAllowedAxises.allowY;\n                allowX = dragAllowedAxises.allowX;\n\n                if (this.core.outer.hasClass('lg-zoomed')) {\n                    if (\n                        this.$LG(e.target).hasClass('lg-object') &&\n                        (allowX || allowY)\n                    ) {\n                        e.preventDefault();\n                        startCoords = this.getDragCords(e);\n\n                        possibleSwipeCords = this.getPossibleSwipeDragCords();\n\n                        isDragging = true;\n\n                        this.core.outer\n                            .removeClass('lg-grab')\n                            .addClass(\n                                'lg-grabbing lg-zoom-drag-transition lg-zoom-dragging',\n                            );\n                        // reset opacity and transition duration\n                    }\n                }\n            }\n        });\n\n        this.$LG(window).on(\n            `mousemove.lg.zoom.global${this.core.lgId}`,\n            (e) => {\n                if (isDragging) {\n                    isMoved = true;\n                    endCoords = this.getDragCords(e);\n\n                    const distance = this.getZoomSwipeCords(\n                        startCoords,\n                        endCoords,\n                        allowX,\n                        allowY,\n                        possibleSwipeCords,\n                    );\n\n                    this.setZoomSwipeStyles(_LGel, distance);\n                }\n            },\n        );\n\n        this.$LG(window).on(`mouseup.lg.zoom.global${this.core.lgId}`, (e) => {\n            if (isDragging) {\n                endTime = new Date();\n                isDragging = false;\n                this.core.outer.removeClass('lg-zoom-dragging');\n\n                // Fix for chrome mouse move on click\n                if (\n                    isMoved &&\n                    (startCoords.x !== endCoords.x ||\n                        startCoords.y !== endCoords.y)\n                ) {\n                    endCoords = this.getDragCords(e);\n\n                    const touchDuration =\n                        endTime.valueOf() - startTime.valueOf();\n                    this.touchendZoom(\n                        startCoords,\n                        endCoords,\n                        allowX,\n                        allowY,\n                        touchDuration,\n                    );\n                }\n\n                isMoved = false;\n            }\n\n            this.core.outer.removeClass('lg-grabbing').addClass('lg-grab');\n        });\n    }\n\n    closeGallery(): void {\n        this.resetZoom();\n    }\n\n    destroy(): void {\n        // Unbind all events added by lightGallery zoom plugin\n        this.$LG(window).off(`.lg.zoom.global${this.core.lgId}`);\n        this.core.LGel.off('.lg.zoom');\n        this.core.LGel.off('.zoom');\n        clearTimeout(this.zoomableTimeout);\n        this.zoomableTimeout = false;\n    }\n}\n"]},"metadata":{},"sourceType":"module"}